<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="images/logo.avif" sizes="any">
    <title>Paiement par Carte - MPE Digital</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { background: radial-gradient(circle at top right, #2c64e3, #1a1a1a 50%); color: white; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; }
        .form-control { background: rgba(255,255,255,0.05) !important; border: 1px solid rgba(255,255,255,0.2) !important; color: white !important; }
        .form-control::placeholder { color: rgba(255,255,255,0.3); }
        .card-preview { background: linear-gradient(135deg, #2c64e3, #1e1e1e); border-radius: 15px; min-height: 180px; position: relative; overflow: hidden; }
    </style>
</head>
<body class="d-flex align-items-center min-vh-100">
    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-12 col-md-8 col-lg-6">
                <div class="glass-card p-4 p-md-5">
                    <a href="paiement.html" class="text-white-50 text-decoration-none small mb-4 d-inline-block"><i class="bi bi-arrow-left me-2"></i>Retour</a>
                    
                    <div class="card-preview p-4 mb-4 shadow">
                        <div class="d-flex justify-content-between align-items-start mb-4">
                            <i class="bi bi-chip h2 text-warning"></i>
                            <i class="bi bi-wifi h3 rotate-90 text-white-50"></i>
                        </div>
                        <h4 class="mb-4 tracking-widest" id="cardNumDisplay">**** **** **** ****</h4>
                        <div class="d-flex justify-content-between">
                            <small class="text-white-50">TITULAIRE<br><span class="text-white" id="cardNameDisplay">NOM PRENOM</span></small>
                            <small class="text-white-50">EXPIRATION<br><span class="text-white" id="cardExpDisplay">MM/AA</span></small>
                        </div>
                    </div>

                    <form id="cardForm">
                        <div class="mb-3">
                            <label class="small fw-bold text-white-50">Nom sur la carte</label>
                            <input type="text" id="nameInp" class="form-control" placeholder="JEAN DUPONT" required>
                        </div>
                        <div class="mb-3">
                            <label class="small fw-bold text-white-50">Numéro de carte</label>
                            <input type="tel" id="numInp" class="form-control" maxlength="19" placeholder="4242 4242 4242 4242" required>
                        </div>
                        <div class="mb-3">
                            <label class="small fw-bold text-white-50">Montant</label>
                            <input type="tel" id="montantInp" class="form-control" maxlength="19" placeholder="100000£" required>
                        </div>
                        <div class="row">
                            <div class="col-6 mb-3">
                                <label class="small fw-bold text-white-50">Date d'expiration</label>
                                <input type="text" id="expInp" class="form-control" placeholder="MM/AA" maxlength="5" required>
                            </div>
                            <div class="col-6 mb-4">
                                <label class="small fw-bold text-white-50">CVC</label>
                                <input type="password" class="form-control" placeholder="123" maxlength="3" required>
                            </div>
                        </div>
                        <button class="btn btn-primary w-100 py-3 fw-bold rounded-3 shadow">
                            Payer maintenant <i class="bi bi-lock-fill ms-2"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>

document.addEventListener('DOMContentLoaded', () => {
    // Éléments du formulaire
    const cardForm = document.getElementById('cardForm');
    const numInp = document.getElementById('numInp');
    const expInp = document.getElementById('expInp');
    const nameInp = document.getElementById('nameInp');
    const cvcInp = document.querySelector('input[type="password"]');
    const submitBtn = cardForm.querySelector('button');
    const montantInp = document.getElementById('montantInp');


    // Éléments d'affichage (Carte virtuelle)
    const cardNumDisplay = document.getElementById('cardNumDisplay');
    const cardNameDisplay = document.getElementById('cardNameDisplay');
    const cardExpDisplay = document.getElementById('cardExpDisplay');
    const wifiIcon = document.querySelector('.bi-wifi'); // On va s'en servir pour le logo

    // 1. RESTRICTION : Uniquement des chiffres
    const onlyNums = (e) => {
        if (!/[0-9]/.test(e.key)) e.preventDefault();
    };

    montantInp.addEventListener('keypress', onlyNums);
    numInp.addEventListener('keypress', onlyNums);
    expInp.addEventListener('keypress', onlyNums);
    cvcInp.addEventListener('keypress', onlyNums);

    // 2. DÉTECTION VISA/MASTERCARD & FORMATAGE NUMÉRO
    
       // Cible l'élément qui contient l'icône à droite de la puce
const cardBrandContainer = document.querySelector('.card-preview .d-flex.justify-content-between div:last-child') || document.querySelector('.bi-wifi').parentElement;

numInp.addEventListener('input', (e) => {
    let value = e.target.value.replace(/\D/g, ''); // Nettoyage
    
    // Détection et remplacement de l'icône par le logo
    if (value.startsWith('4')) {
        cardBrandContainer.innerHTML = `<img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" style="height: 20px; filter: brightness(0) invert(1);">`;
    } else if (value.startsWith('5')) {
        cardBrandContainer.innerHTML = `<img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" style="height: 30px;">`;
    } else {
        // Retour à l'icône Wi-Fi par défaut si rien n'est détecté
        cardBrandContainer.innerHTML = `<i class="bi bi-wifi h3 rotate-90 text-white-50"></i>`;
    }

    // Formatage du numéro sur la carte
    e.target.value = value.replace(/(\d{4})(?=\d)/g, '$1 ').trim();
    cardNumDisplay.innerText = e.target.value || "**** **** **** ****";
});


    // 3. FORMATAGE DATE EXPIRATION (MM/AA)
    expInp.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length >= 2) {
            e.target.value = value.substring(0, 2) + '/' + value.substring(2, 4);
        } else {
            e.target.value = value;
        }
        cardExpDisplay.innerText = e.target.value || "MM/AA";
    });

    // 4. MISE À JOUR NOM
    nameInp.addEventListener('input', (e) => {
        cardNameDisplay.innerText = e.target.value.toUpperCase() || "NOM PRENOM";
    });

    // 5. SIMULATION VÉRIFICATION BANCAIRE
    cardForm.addEventListener('submit', (e) => {
        e.preventDefault();

        // Désactivation du bouton et changement d'état
        submitBtn.disabled = true;
        const originalContent = submitBtn.innerHTML;
        submitBtn.innerHTML = `
            <span class="spinner-border spinner-border-sm me-2"></span>
            Vérification bancaire...
        `;

        // Simulation d'un délai de réponse serveur/banque
        setTimeout(() => {
            // Simulation de succès
            submitBtn.classList.replace('btn-primary', 'btn-success');
            submitBtn.innerHTML = `<i class="bi bi-check-circle-fill me-2"></i> Paiement Accepté`;

            console.log("TRANSACTION BANCAIRE RÉUSSIE");
            console.log("Titulaire:", nameInp.value);
            console.log("Carte:", numInp.value.replace(/\d(?=\d{4})/g, "*")); // Masquage sécurité

            setTimeout(() => {
                alert("Votre paiement a été validé avec succès !");
                // window.location.href = "succes.html"; // Redirection
            }, 500);

        }, 3000); // 3 secondes de délai
    });
});


        // Logique de mise à jour de la carte en temps réel
        // const ni = document.getElementById('numInp');
        // const nm = document.getElementById('nameInp');
        // const ex = document.getElementById('expInp');

        // ni.oninput = (e) => {
        //     let val = e.target.value.replace(/\W/gi, '').replace(/(.{4})/g, '$1 ').trim();
        //     e.target.value = val;
        //     document.getElementById('cardNumDisplay').innerText = val || "**** **** **** ****";
        // };
        // nm.oninput = (e) => document.getElementById('cardNameDisplay').innerText = e.target.value.toUpperCase() || "NOM PRENOM";
        // ex.oninput = (e) => {
        //     let val = e.target.value.replace(/\W/gi, '').replace(/(.{2})/, '$1/').trim();
        //     e.target.value = val;
        //     document.getElementById('cardExpDisplay').innerText = val || "MM/AA";
        // };

        // document.getElementById('cardForm').onsubmit = (e) => {
        //     e.preventDefault();
        //     alert("Traitement sécurisé en cours via Stripe/MPE...");
        // };
    </script>
</body>
</html>